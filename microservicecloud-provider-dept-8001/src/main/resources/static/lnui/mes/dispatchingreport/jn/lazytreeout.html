<!DOCTYPE html>
<html>
<head>
<title>生产进度查询</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<!-- <link href="miniui/demo/demo.css" rel="stylesheet" type="text/css" /> -->
<link href="miniui/scripts/miniui/themes/icons.css" rel="stylesheet"
	type="text/css">
<link href="miniui/scripts/miniui/themes/default/miniui.css"
	rel="stylesheet" type="text/css">
	<link href="../../../../jslib/bootstrap/css/bootstrap.min.css"
	rel="stylesheet" type="text/css">
<style type="text/css" mce_bogus="1">
table th {
	white-space: nowrap;
}

table td {
	white-space: nowrap;
}
</style>
</head>
<body marginwidth="0" marginheight="0">
	<h1>生产进度查询</h1>
	<div>
		<label>客户名称：</label>
		<input id="kehu" style="width: 200px;" />
		<label>合同编号：</label>
		<input id="hetong" style="width: 200px;" />
		<label>产品编码：</label>
		<input id="chanpin" style="width: 200px;" />
		<a class="mini-button" onclick="search()">查询</a>
		<a class="mini-button" onclick="excel()">导出</a>
		<label>工作中心：</label>
		<input id="centerid" style="width: 200px;"/>
		<a class="mini-button" onclick="searchDispatchingOrder()">查询派工单</a>
	</div>
	<div></div>
	<div class="modal fade" id="tipModal" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="myModalLabel">提示</h4>
				</div>
				<div class="modal-body" id="tips"></div>
				<div class="modal-footer" id="sure">

				</div>
			</div>
		</div>
	</div>
	<div class="row"  >
				<div class="col-sm-12" >
					<div class="modal fade bs-example-modal-lg" id="dispatchingModal" tabindex="-1" role="dialog"  aria-labelledby="myModalLabel"  aria-hidden="true" >
						<div class="modal-dialog" style="width:95%;">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close"  data-dismiss="modal" aria-hidden="true"> &times;</button>
					            	<h4 class="modal-title" id="myModalLabel">派工单</h4>
					         	</div>



									<div class="col-sm-12" style="width:100%;height:600px;overflow-x:auto;overflow-y:auto" align="center">
										<table class="table table-bordered" id="dispatchingTable" >

											<tbody id="dispatchingorderList">
											</tbody>
										</table>

									</div>



								<div class="modal-footer">
					        	 </div>

							</div>
						</div>
					</div>
				</div>
			</div>
	<iframe id="lazy" name="ifrmname" src="lazytree.html" width="1580px"
		height="700px" frameborder="no" border="0" marginwidth="0"
		marginheight="0" scrolling="true" allowtransparency="yes"></iframe>
</body>
<script src="miniui/scripts/boot.js" type="text/javascript"></script>
<script src="miniui/scripts/miniui/miniui.js" type="text/javascript"></script>
<script type="text/javascript" src="../../../../jslib/leanway/jn_common.js"></script>
<script src="../../../../jslib/jQuery/jQuery-2.1.4.min.js"></script>
<script src="../../../../jslib/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript">
	function search() {
		document.getElementById('lazy').contentWindow.location.reload(true);
	}
	function excel() {
		window.open("../../../../" + ln_project + "/productionGroupReport"
				+ "?method=exportJnTreeGradeReporWsInterface" //
				+ "&kehu=" + $("#kehu").val() //
				+ "&hetong=" + $("#hetong").val() //
				+ "&chanpin=" + $("#chanpin").val());
	}
	
	function searchDispatchingOrder(){
		if($("#centerid").val()==""||$("#centerid").val()==null){
			lwalert("tipModal", 1, "请填写工作中心再进行查询！");
			return;
		}
		$.ajax({
            type : "post",
            url : "../../../../"+ln_project+"/dispatchingOrder?method=queryDispatchingOrderByCenternameWsInterface",
            data : {
                "centername":$("#centerid").val(),
            },
            dataType : "text",
            success : function(data) {
                var flag =  com.leanway.checkLogind(data);
                var tempData = $.parseJSON(data);
                if(flag){
                	if(tempData.length==0){
                		lwalert("tipModal", 1, "该工作中心没有派工单！");
                	}else{
                    	viewDispatchingOrder(tempData);
                	}
                }
            },
            error : function(data) {

            }
        });
	}
	function viewDispatchingOrder(orderList){
		$('#dispatchingorderList').html("");
		$('#dispatchingModal').modal({backdrop: 'static', keyboard: true});

		var tempHtml = '<tr"><th>派工单号</th>'
			          +'<th>工单号</th>'
			          +'<th>产品名称</th>'
			          +'<th>工序名称</th>'
			          +'<th>工序行号</th>'
			          +'<th>机器工作中心</th>'
			          +'<th>人工工作中心</th>'
			          +'<th>调整开始时间</th>'
			          +'<th>调整结束时间</th>'
			          +'<th>实际开始时间</th>'
			          +'<th>实际结束时间</th>'
			          +'<th>数量</th>'
			          +'<th>剩余数量</th></tr>';
		for(var i = 0; i < orderList.length; i ++){
			tempHtml +='<tr><td>'+orderList[i].dispatchingnumber+'</td>'
			         +'<td>'+orderList[i].productionnumber+'</td>'
			         +'<td>'+orderList[i].productordesc+'</td>'
			         +'<td>'+orderList[i].procedurename+'</td>'
			         +'<td>'+orderList[i].line+'</td>'
			         +'<td>'+orderList[i].centername+'</td>'
			         +'<td>'+orderList[i].personcentername+'</td>'
			         +'<td>'+orderList[i].adjuststarttime+'</td>'
			         +'<td>'+orderList[i].adjustendtime+'</td>'
			         +'<td>'+(orderList[i].practicalstarttime==null?"":orderList[i].practicalstarttime)+'</td>'
			         +'<td>'+(orderList[i].practicalendtime==null?"":orderList[i].practicalendtime)+'</td>'
			         +'<td>'+orderList[i].count+'</td>'
			         +'<td>'+orderList[i].surplusnumber+'</td></tr>';
			$('#dispatchingorderList').html(tempHtml);
		}
	}

</script>
</html>