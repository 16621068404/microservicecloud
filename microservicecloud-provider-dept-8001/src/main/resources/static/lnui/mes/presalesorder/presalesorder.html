<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>销售订单</title>
<meta
	content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
	name="viewport">
<link rel="stylesheet"href="../../../jslib/leanway/loader_datatables.css">
<!--[if lt IE 9]>
  <script src="plugin/html5shiv.3.7.3/html5shiv.min.js"></script>
  <script src="plugin/respond.1.4.2/respond.min.js"></script>
  <![endif]-->

 <style type="text/css">
.ztree-wrap {height:320px; overflow:auto;}
table th {
    white-space: nowrap;
}

table td {
    white-space: nowrap;
}
.center{
position: fixed;
left: 30%;
margin-top:23%;
}

.infocenter{
position: fixed;
left: 25%;
margin-top:25%;
}
</style>
</head>

<body>
	<!-- Main content -->
	<section class="content">
<!-- 	<ol class="breadcrumb">
			<li><i class="fa fa-home"></i></li>
			<li class="active">销售管理</li>
			<li class="active">预销售订单</li>
			<li class="active"></li>
		</ol> -->
			<div class="col-sm-12">
				<div class="box box-primary" id="box1">
					<div class="box-header with-border">
						<div class="pull-left">
							<h3 class="box-title">订单列表</h3>
							&nbsp;&nbsp; <a onclick="addSalesOrder();"
								id="addFun" class="btn btn-default btn-flat  btn-xs">新增</a> <a
								onclick="showEditSalesOrder();" id="editFun"
								class="btn btn-default btn-flat   btn-xs">修改</a>
								<!-- <a onclick="deleteSalesOrder();" id="deleteFun"
								class="btn btn-default btn-flat   btn-xs">删除</a> -->
								<div class="btn-group">
					      		<button aria-expanded="false" aria-haspopup="true" data-toggle="dropdown" class="btn btn-default btn-flat btn-xs dropdown-toggle" type="button" id="delFun">删除 <span class="caret"></span></button>
					     			<ul class="dropdown-menu">
								        <li><a onclick="deleteSalesOrder(1)" id="deleteCurrentFun">当前选中数据</a></li>
					      			    <li><a onclick="deleteSalesOrder(2)" id="deleteAllFun">跨页选中数据</a></li>
							      </ul>
					    	    </div>
						<!-- 		 <button
								onclick="createProductionOrder(2);" id="createOrderFun"
								class="btn btn-default btn-flat   btn-xs">生成生产订单</button> -->
<!-- 							<button class="btn btn-default btn-flat btn-xs" onclick="createProductionOrder(2, 0, 0);" id="createOrderFun">生成生产订单</button>
 -->							<div class="btn-group">
				      			<button aria-expanded="false" aria-haspopup="true" data-toggle="dropdown" class="btn btn-default btn-flat btn-xs dropdown-toggle" type="button" id="createFun">生成生产订单<span class="caret"></span></button>
				     			<ul class="dropdown-menu">
							        <li><a onclick="createProductionOrder(2, 0, 0, 1);" id="createAllFun">销售订单生成生产订单</a></li>
				      			    <li><a onclick="createProductionOrder(2, 0, 0, 2);" id="createSelectFun">明细产品生成生产订单</a></li>
						        </ul>
				    	    </div>
							<!-- <button class="btn btn-default btn-flat btn-xs" onclick="createProductionOrder(2, 0, 1);" id="createCurOrderFun">生成当前产品订单</button>
					 -->
							<div class="btn-group">
				      			<button aria-expanded="false" aria-haspopup="true" data-toggle="dropdown" class="btn btn-default btn-flat btn-xs dropdown-toggle" type="button" id="createCurOrderFun">生成当前产品订单<span class="caret"></span></button>
				     			<ul class="dropdown-menu">
							        <li><a onclick="createProductionOrder(2, 0, 1, 1);" id="createAllFun">全部|当前产品生成生产订单</a></li>
				      			    <li><a onclick="createProductionOrder(2, 0, 1, 2);" id="createSelectFun">勾选|当前产品生成生产订单</a></li>
						        </ul>
				    	    </div>

			<!-- 				<div class="btn-group">
							  <button class="btn btn-default btn-flat btn-xs" onclick="createProductionOrder(2, 0);" id="createOrderFun">生成生产订单</button>
							  <button type="button" class="btn btn-default btn-flat btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="dropdown">
							    <span class="caret"></span>
							    <span class="sr-only">Toggle Dropdown</span>
							  </button>
							  <ul class="dropdown-menu">
							     <li><a href="#" onclick="createDispatchingOrder(1)">选中数据生成</a></li>
							    <li><a onclick="createProductionOrder(2, 1)">重复制造生产订单</a></li>
							  </ul>
							</div> -->

							<div class="btn-group">
							<button aria-expanded="false" aria-haspopup="true" data-toggle="dropdown" class="btn btn-default btn-flat btn-xs dropdown-toggle" type="button" id="deleteFun">删除生产订单<span class="caret"></span></button>
			     			<!-- <button onclick="deleteProduction(1);" id="deleteProduction" class="btn btn-default btn-flat   btn-xs">删除生产订单</button> -->
			     			<ul class="dropdown-menu">
						        <li><a onclick="checkProductionOrderIsSync(2,1);" id="deleteProductionAll">删除销售订单的生产订单</a></li>
			      			    <li><a onclick="checkProductionOrderIsSync(2,2);" id="deleteSelectProduction">删除选中产品的生产订单</a></li>
					        </ul>
					        </div>
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
							<br>

							<!-- <div class="progress" id="progressDiv"  style="display: none;">
								 <div class="progress-bar" style="width: 0%;  role="progressbar" id="progressBarDiv">
				                    <span id="progressInfo" >0%</span>
				                </div>
								<label id="progressInfo" style="padding-left: 100px;text-align: center;">生成中：0%</label>
								<label style="padding-right: 1px;float: right;" onclick="showOrderInfo()" ><a>详细</a></label>
							</div> -->

							<div style="width: 100%">
								<span id="orderInfo"  style="display: none;color: #3c8dbc;" ></span>
							</div>

						</div>
						<div class="pull-right">
							<a onclick="watchSalesOrder();" id="watchFun"
								class="btn btn-default btn-flat   btn-xs">查看订单明细</a>
                    							<button type="button" class="btn btn-box-tool"
								data-widget="collapse" id="btn1" onclick="clickOthers2('btn1','btn2','btn3')"><i class="fa fa-minus" id="min1" ></i></button>
						</div>
					</div>
					<div class="box-body">

                          <form class="form-inline" role="form" style="padding-top: 5px;">
	                          <div class="form-group">
	
			                    <div class=" col-sm-1 input-group">
			                          <input type="text" placeholder="请输入关键字" id ="searchValue"  name = "searchValue" class="input-sm form-control"  style="width: 350px; height : 32px;">
			                          <span class="input-group-btn"><button type="button" class="btn btn-sm btn-primary" onclick="searchPreSalesOrder()" style="height : 32px;"> 表头查询</button> </span>
			                          
			                          
			                    </div>
			                    
			                     <div class=" col-sm-1 input-group">
			                           
			                          <input type="text" placeholder="请输入查询号" id ="detailSearchValue"  name = "detailSearchValue" class="input-sm form-control" style="width: 350px; height : 32px;">
				                      <span class="input-group-btn"><button type="button" class="btn btn-sm btn-primary" onclick="searchPreSalesOrderDetail()" style="height : 32px;">表体查询</button> </span>
			                    </div>
			                   
		                     </div>
	                     </form>

						<!-- Your Page Content Here -->
						<table id="salesOrderDataTable"
							class="table table-striped table-bordered table-hover" style="width: 100%">
							<thead>
								<tr>
									<td style="width: 15px;"><input type="checkbox" id="checkAll" onclick="com.leanway.dataTableCheckAll('salesOrderDataTable', 'checkAll', 'checkList')" class="regular-checkbox"><label for="checkAll"></label></td>
									<td>订单号</td>
									<td>是否下发</td>
									<td>联系人</td>
									<td>总价</td>
									<td>订单日期</td>
									<td>交货日期</td>
									<td>交货提前期</td>
									<td>销售地点</td>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
 				<div class="overlay" id="mask" hidden="">
            		  <div class="progress center" id="progressDiv"    style="display: none; " >
								 <div class="progress-bar" style="width: 0%;  role="progressbar" id="progressBarDiv">
				                    <span id="progressInfo" >0%</span>
				                </div>
								<!-- <label id="progressInfo" style="padding-left: 100px;text-align: center;">生成中：0%</label> -->
<!-- 								<label style="padding-right: 1px;float: right;" onclick="showOrderInfo()" ><a>详细</a></label>
 -->					 </div>
					 <div style="width: 100%" class="infocenter">
						 <span id="orderInfo2"  style="color: #3c8dbc;" ></span>
					</div>
           		 </div>
				</div>
			</div>
			<div class="col-sm-12">
			<form class="form-horizontal" id="salesOrderForm">
				<div class="box box-info  collapsed-box" id="box2">
					<div class="box box-solid">
						<div class="box-header with-border">
							<h3 class="box-title">预销售订单</h3>
							&nbsp;
								<!--<button id="resetButtonId" onclick="resetPageForm();" class="btn btn-danger" data-toggle="modal">重置</button>&nbsp;  -->
									<button type="button" id="saveOrUpdateButtonId"
								onclick="saveOrUpdate();"
								class="btn btn-default btn-flat   btn-xs" data-toggle="modal">保存</button>
						<div class="box-tools">
								<a type="button" class="btn btn-box-tool" data-widget="collapse"
									id="btn2" onclick="clickOthers2('btn2','btn1','btn3')"> <i class="fa fa-minus" id="min2"></i></a>
							</div>
						</div>
						<div class="box-body">
								<div class="form-group">
									<input type="hidden" id="salesorderid" name="salesorderid">
									<input type="hidden" id="compid" name="compid">
									<input type="hidden" id="status" name="status">
									<input type="hidden" id="sort" name="sort">
									<input type="hidden" id="createtime" name="createtime">
									<input type="hidden" id="createuser" name="createuser">
									<input type="hidden" id="modifydate" name="modifydate">
									<input type="hidden" id="modifyuser" name="modifyuser">
									<input type="hidden" id="salesOrderDetailList" name="salesOrderDetailList">
								</div>
								<div class="form-group">

									<!-- <input class="form-control"  id="code" name="code" type="hidden"
										placeholder="订单号"> -->
									<label class="col-sm-1 control-label" for="code">订单号</label>
									<div class="col-sm-2">
										<input class="form-control" id="code" name="code"
											type="text" placeholder="订单号" />
									</div>

									<label class="col-sm-1 control-label" for="salestype">订单类型</label>
									<div class="col-sm-2 ">
										<select name="salestype" id="salestype" class="form-control">
											<option value="1">系统</option>
											<option value="2">内销</option>
											<option value="3">外销</option>
										</select>
									</div>
									<label class="col-sm-1 control-label" for="salescategory">订单性质</label>
									<div class="col-sm-2">
										<select name="salescategory" id="salescategory" class="form-control">
											<option value="1">集团企业</option>
											<option value="2">内部直销</option>
										</select>
									</div>
										<!--
									   <label class="col-sm-1 control-label" for="salesstatus">订单状态</label>
                                    <div class="col-sm-2 ">
                                        <select class="form-control" id="salesstatus" name="salesstatus">
                                            <option value="1">计划</option>
                                            <option value="2">确认</option>
                                            <option value="3">投产</option>
                                            <option value="4">关闭</option>
                                        </select>
                                    </div>
                                    -->
									<label class="col-sm-1 control-label" for="salesaddress">销售地点</label>
									<div class="col-sm-2">
										<input class="form-control" id="salesaddress" name="salesaddress"
											type="text" placeholder="销售地点" />
									</div>

                    
								</div>

								<div class="form-group">
									<label class="col-sm-1 control-label" for="salesdate">订单日期</label>
									<div class="col-sm-2">
										<input class="form-control" id="salesdate" name="salesdate"
											type="text" placeholder="订单日期" />
									</div>
									<label class="col-sm-1 control-label" for="requestdate">交货日期</label>
									<div class="col-sm-2">
										<input class="form-control" id="requestdate" name="requestdate"
											type="text" placeholder="交货日期" onchange="setShippingdate()"/>
									</div>

                                    <label class="col-sm-1 control-label" for="shippingdate">装运日期</label>
                                    <div class="col-sm-2">
                                        <input class="form-control" id="shippingdate" name="shippingdate"
                                            type="text"  placeholder="装运日期"  />
                                    </div>
                                    <label class="col-sm-1 control-label" for="producefinishdate">完工日期</label>
                                    <div class="col-sm-2">
                                        <input class="form-control" id="producefinishdate" name="producefinishdate"
                                            type="text" placeholder="生产完工日期" />
                                    </div>
								</div>
								<div class="form-group">
                                    <label class="col-sm-1 control-label" for="deliveryleadtime" id="deliveryleadtimelabel">交货提前期</label>
                                    <div class="col-sm-2">
                                        <input class="form-control" id="deliveryleadtime" name="deliveryleadtime"
                                            type="text" onblur="getShippingdate()" placeholder="交货提前期" />
                                    </div>
									<label class="col-sm-1 control-label" for="contacts">联系人</label>
									<div class="col-sm-2">
										<input class="form-control" id="contacts" name="contacts"
											type="text" placeholder="联系人" />
									</div>
									
						          	<label class="col-sm-1 control-label" for="ischaosorder">是否混排</label>
									<div class="col-sm-2">
										<label class="radio-inline" style="padding-left: 20px;">
										  <input type="radio" name="ischaosorder" id="ischaosorder" value="0" checked="checked" >否
										</label>
										<label class="radio-inline">
										 <input type="radio" name="ischaosorder" id="ischaosorder" value="1" >是
										</label>
									</div>
									<!--
                                    <label class="col-sm-1 control-label" for="price">总价</label>
                                    <div class="col-sm-2">
                                        <input class="form-control" id="price" name="price"
                                            type="text" placeholder="总价" />
                                    </div>
									-->
								</div>


						</div>
					</div>
				</div>
				</form>
			</div>


			<div class="col-xs-12">
				<div class="box box-success  collapsed-box" id="box3">
					<div class="box box-solid">
						<div class="box-header with-border">
								<h3 class="box-title">订单产品</h3>
							&nbsp;&nbsp;

							<button type="button" id="deleteEditDataTableId"
								onclick="deleteSalesOrderDetail();"
								class="btn btn-default btn-flat   btn-xs">删除</button>
							<button type="button" id="batch-edit-btn"
								class="btn btn-default btn-flat   btn-xs">批量编辑</button>
							<button type="button" id="batch-save-btn"
								class="btn btn-default btn-flat   btn-xs">批量保存</button>
							<button class="btn btn-default btn-flat btn-xs" onclick="relevance();" id="relevanceOrder">关联预售订单</button>


							<div class="box-tools">
								<button type="button" class="btn btn-box-tool"
									data-widget="collapse" id="btn3" onclick="clickOthers2('btn3','btn2','btn1')"><i class="fa fa-minus" id="min3"></i></button>
							</div>
						</div>
						<div class="box-body table-responsive no-padding">
							<form class="form-horizontal" id="editSalesOrderDetailForm">
								<table class="table table-striped table-bordered table-hover" style="width: 100%" id="editSalesOrderDetailsTable">
									<thead>
										<tr>
											<td style="width: 30px"><input type="checkbox" id="editCheckAll" name="editCheckAll" onclick="com.leanway.dataTableCheckAll('editSalesOrderDetailsTable', 'editCheckAll', 'editCheck')" class="regular-checkbox"><label for="editCheckAll"></label></td>
											<td style="width: 90px;">产品</td>
											<td style="width: 70px;">版本</td>
											<td style="width: 90px;">描述</td>
											<td style="width: 90px;">规格</td>
											<td style="width: 70px;">单位</td>
											<td style="width: 90px;">设备台账</td>
											<td style="width: 90px;">数量</td>
											<td style="width: 90px;">单价</td>
											<td style="width: 90px;">完工日期</td>
											<td style="width: 90px;">可完工日期</td>
											<td style="width: 70px;">优先级</td>
											<td style="width: 90px;">状态</td>
											<td style="width: 90px;">生产查询号</td>
											<td style="width: 90px;">显示生产进度</td>
											<td style="width: 90px;">备注</td>
											<!-- <td style="width: 90px;">合同号</td> -->
											<td>行号</td>
											<td style="width: 30px;">操作</td>
											

										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</form>
						</div>
						<div align="right">
							<button type="button" id="addEditDataTableId"
								class="btn btn-sm btn-primary">
								新增
							</button>
						</div>
					</div>
				</div>
			</div>
	</section>
	<!-- /.content -->


<div class="modal fade" id="relevanceModal"  role="dialog"  aria-labelledby="myModalLabel"  aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
 					<div class="modal-header">
						<button type="button" class="close"  data-dismiss="modal" aria-hidden="true"> &times;</button>
		            	<h4 class="modal-title" id="myModalLabel">关联预销售明细</h4>
		            	<button class="btn btn-default  btn-xs" onclick="deleteRelevance()"><i class="fa fa-times"></i>&nbsp;解除关联</button>
		                <button class="btn btn-default  btn-xs" onclick="nextLevels()" id="nextLevels">下一级</button>

		         	</div>

					<div class="modal-body" >
							<div class="box-body table-responsive no-padding">

								<div class="col-sm-12"  style="min-height:250px;overflow-y:auto;max-height:350px;padding-top: 5px;overflow-x:hidden;">

									<div class="form-horizontal clearfix">
					                    <div class="col-sm-6 input-group">
					                          <input type="text" placeholder="请输入订单号、生产查询号、产品编码、产品名称搜索" id ="relevanceSearchValue"  name = "relevanceSearchValue" class="input-sm form-control">
					                          <span class="input-group-btn"><button type="button" class="btn btn-sm btn-primary" onclick="searchPreOrder()"> 搜索</button> </span>
					                    </div>
					                </div>

									<table id="viewRelevanceTables" class="table table-striped table-bordered table-hover" >
									 	<thead>
											<tr>
												<th style="width: 10px"><input type="checkbox" id="relevanceCheckAll" name="relevanceCheckAll" onclick="com.leanway.dataTableCheckAllNoSave('viewRelevanceTables', 'relevanceCheckAll', 'relevanceCheck')" class="regular-checkbox"><label for="relevanceCheckAll"></label></th>
												<th style="width: 100px">订单号</th>
												<th style="width: 50px">生产查询号</th>
												<th style="width: 50px">订单数量</th>
												<th style="width: 50px">未关联数</th>
												<th style="width: 50px">本订单关联数</th>
												<!-- <th style="width: 40px" title="销售明细关联的子查询号数量（非关联产品的数量）"><a>关联数</a></th> -->
												<th style="width: 100px">产品图号</th>
												<th style="width: 100px">产品编码</th>
												<th style="width: 100px">产品名称</th>
												<!-- <th style="width: 100px">可关联数量</th> -->
											</tr>
						       		 	</thead>
									</table>
								</div>

					<!-- 			 <div class="col-sm-3" >
								 	<div class="ztree-wrap">
										<ul id="treeProductionOrder" class="ztree"></ul>
									</div>
								 </div> -->
							</div>
					</div>

					<div class="modal-footer">
		           		<button type="button" class="btn btn-default"  id="modalClose" data-dismiss="modal">关闭</button>
		           		<button type="button" class="btn btn-primary"  id="saveRelevance"  onclick="saveRelevance()">保存</button>
		        	 </div>

				</div>
			</div>
		</div>
<div class="modal fade" id="tipModal" tabindex="-1" role="dialog"
						aria-labelledby="myModalLabel" aria-hidden="true">
						<div class="modal-dialog modal-sm">
							<div class="modal-content">

								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal"
										aria-hidden="true">&times;</button>
									<h4 class="modal-title" id="myModalLabel">提示</h4>
								</div>

								<div class="modal-body" id="tips"></div>
								<div class="modal-footer" id="sure">

								</div>
							</div>
						</div>
					</div>
	<!-- jQuery 2.1.4 -->
	<script src="../../../jslib/jQuery/jQuery-2.1.4.min.js"></script>
	<!-- Bootstrap 3.3.5 -->
	<script src="../../../jslib/bootstrap/js/bootstrap.min.js"></script>
	<!-- bootstrapValidator -->
	<script src="../../../jslib/bootstrap-validator/js/bootstrapValidator.js"></script>
	<script src="../../../jslib/bootstrap-validator/js/language/zh_CN.js"></script>
	<!-- SlimScroll -->
	<script src="../../../jslib/slimScroll/jquery.slimscroll.min.js"></script>
	<!-- FastClick -->
	<script src="../../../jslib/fastclick/fastclick.js"></script>
	<!-- AdminLTE App -->
	<script src="../../../jslib/adminlte/js/app.min.js"></script>
	<!-- DateTime -->
	<script type="text/javascript" src="../../../jslib/datetimepicker/bootstrap-datetimepicker.js" charset="UTF-8"></script>
    <script type="text/javascript" src="../../../jslib/datetimepicker/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
	<script src="../../../jslib/select2/select2.full.min.js"></script>
	<script src="../../../jslib/select2/i18n/zh-CN.js"></script>
	<!-- DataTables -->
	<script src="../../../jslib/datatables/jquery.dataTables.js"></script>
	<script src="../../../jslib/datatables/dataTables.bootstrap.js"></script>
	<script src="../../../jslib/leanway/jn_common.js"></script>
	<script type="text/javascript" src="presalesorder.js"></script>
</body>

</html>
